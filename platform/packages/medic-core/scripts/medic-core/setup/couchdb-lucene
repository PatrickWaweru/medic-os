#!/bin/sh

main()
{
  local self="`realpath "$0"`"
  local base="`dirname -- "$self"`"

  source "/boot/include/template" || return 255

  source "$base/../env" &&
  merge_environment /srv || return 255

  local password="`cat "$SERVICE_PASSWD_PATH/lucene"`" \
    || return 0

  local src="$PACKAGE_STORAGE/couchdb-lucene/templates/couchdb-lucene.ini.tmpl"
  local dest="$PACKAGE_SETTINGS/couchdb-lucene/couchdb-lucene.ini"

  umask 266 &&
  export PASSWORD="$password" &&
  template_expand 'mustache' "$src" "$dest" &&
  chown couchdb-lucene "$dest"

  return "$?"
}

main "$@"
exit "$?"

