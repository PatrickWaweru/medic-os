#!/bin/sh

start()
{
  local self="`realpath "$0"`"
  local base="`dirname -- "$self"`"

  source "$base/../env" &&
  merge_environment /srv || return 255
  envsubst '$$DOCKER_NETWORK_NAME' < /srv/software/medic-core/v2.1.1/x64/etc/nginx/nginx.conf > /srv/software/medic-core/v2.1.1/x64/etc/nginx/nginx.conf.tmp \
  && mv /srv/software/medic-core/v2.1.1/x64/etc/nginx/nginx.conf.tmp /srv/software/medic-core/v2.1.1/x64/etc/nginx/nginx.conf

  exec /boot/timestamp \
    "$PACKAGE_ROOT/bin/nginx" -p "$PACKAGE_STORAGE/nginx/data" \
      >> "$PACKAGE_STORAGE/nginx/logs/startup.log" 2>&1
}

start
exit "$?"

